# รายงานความก้าวหน้าครั้งที่ 1 (Progress Report 1)
## ระบบพยากรณ์ค่าฝุ่น PM2.5 ด้วยเทคนิค Machine Learning

**รายวิชา:** Machine Learning Systems  
**หัวข้อโครงการ:** PM2.5 Prediction System using Historical Air Quality Dataset  
**แหล่งข้อมูล:** Air4Thai (http://air4thai.pcd.go.th/webV3/#/History)  

---

## 1. ภาพรวมโครงการ (Project Overview)

### 1.1 ความเป็นมาและปัญหา

ปัญหาฝุ่นละอองขนาดเล็ก PM2.5 (Particulate Matter with diameter ≤ 2.5 ไมครอน) เป็นวิกฤตด้านสิ่งแวดล้อมและสาธารณสุขที่ประเทศไทยเผชิญอย่างต่อเนื่อง โดยเฉพาะในช่วงฤดูหนาวและฤดูแล้งที่สภาพอากาศนิ่ง รวมถึงการเผาไหม้ในที่โล่งและการจราจรที่หนาแน่น ส่งผลให้ค่า PM2.5 เกินมาตรฐานที่องค์การอนามัยโลก (WHO) กำหนดไว้ที่ 15 μg/m³ (ค่าเฉลี่ย 24 ชั่วโมง) อยู่บ่อยครั้ง โดยเฉพาะในพื้นที่ภาคเหนือของประเทศไทย เช่น จังหวัดเชียงใหม่ และเชียงราย ที่มักพบค่า PM2.5 เกิน 100 μg/m³ ในช่วงฤดูหมอกควัน

การพยากรณ์ค่า PM2.5 ล่วงหน้าอย่างแม่นยำนั้นมีความสำคัญอย่างยิ่งต่อการแจ้งเตือนประชาชนและการตัดสินใจเชิงนโยบาย การใช้ข้อมูลอนุกรมเวลา (time series) จากสถานีตรวจวัดคุณภาพอากาศ ร่วมกับเทคนิค Machine Learning ที่เหมาะสม จึงเป็นแนวทางที่น่าสนใจสำหรับการสร้างระบบพยากรณ์ที่มีประสิทธิภาพและสามารถนำไปใช้งานจริงได้

### 1.2 วัตถุประสงค์ของระบบ ML

โครงการนี้มีวัตถุประสงค์หลัก ดังนี้:

- **ออกแบบและพัฒนาระบบ ML Pipeline** ที่ครอบคลุมตั้งแต่ Data Engineering, Model Training, Evaluation จนถึง Model Selection อย่างครบวงจรและสามารถทำซ้ำได้ (reproducible)
- **พยากรณ์ค่า PM2.5** ในอีก 1 ชั่วโมงข้างหน้า (short-term forecast) จากข้อมูลอนุกรมเวลาของสถานีตรวจวัดคุณภาพอากาศ
- **เปรียบเทียบประสิทธิภาพ** ของโมเดล Baseline และโมเดลขั้นสูงอย่างเป็นระบบและเป็นธรรม
- **คัดเลือกโมเดลที่เหมาะสม** โดยพิจารณาทั้งในด้านความแม่นยำ ความซับซ้อน และความสามารถในการนำไปใช้งานจริง

### 1.3 ประโยชน์ที่คาดว่าจะได้รับและผู้มีส่วนได้ส่วนเสีย

| กลุ่มผู้มีส่วนได้ส่วนเสีย | ประโยชน์ที่ได้รับ |
|---|---|
| ประชาชนทั่วไป | ได้รับการแจ้งเตือนล่วงหน้า เพื่อป้องกันสุขภาพ เช่น สวมหน้ากาก หรือหลีกเลี่ยงกิจกรรมกลางแจ้ง |
| กลุ่มเสี่ยงสูง (ผู้สูงอายุ เด็ก ผู้ป่วยโรคทางเดินหายใจ) | ได้รับข้อมูลเชิงรุกเพื่อการตัดสินใจด้านสุขภาพ |
| หน่วยงานภาครัฐ (กรมควบคุมมลพิษ สาธารณสุข) | ใช้ประกอบการออกคำสั่งหรือมาตรการควบคุมได้อย่างทันท่วงที |
| นักวิจัยและนักวิชาการ | ได้ต้นแบบ ML Pipeline ที่สามารถต่อยอดและขยายขอบเขตการวิจัยได้ |
| ผู้พัฒนาแอปพลิเคชันด้านสิ่งแวดล้อม | สามารถนำ API จากโมเดลที่พัฒนาแล้วไปประยุกต์ใช้ในผลิตภัณฑ์ต่าง ๆ |

---

## 2. ชุดข้อมูลและคำอธิบายข้อมูล (Dataset & Data Description)

### 2.1 แหล่งที่มาของข้อมูล

ชุดข้อมูลที่ใช้ในโครงการนี้มาจากระบบ **Air4Thai** ของกรมควบคุมมลพิษ กระทรวงทรัพยากรธรรมชาติและสิ่งแวดล้อม ซึ่งเปิดให้เข้าถึงผ่านเว็บไซต์ http://air4thai.pcd.go.th/webV3/#/History โดยระบบดังกล่าวรวบรวมข้อมูลคุณภาพอากาศจากสถานีตรวจวัดทั่วประเทศไทย และบันทึกค่าตรวจวัดในรูปแบบรายชั่วโมง

### 2.2 ประเภทและลักษณะของข้อมูล

ข้อมูลมีลักษณะเป็น **อนุกรมเวลาหลายตัวแปร (multivariate time series)** และ **ตาราง (tabular)** ที่ประกอบด้วยค่าตัวเลข (numerical) ซึ่งถูกบันทึกเป็นรายชั่วโมงจากสถานีตรวจวัดหลายแห่งทั่วประเทศ

### 2.3 ขนาดและคุณลักษณะของข้อมูลโดยประมาณ

| คุณลักษณะข้อมูล (Feature) | คำอธิบาย | หน่วย |
|---|---|---|
| PM2.5 | ค่าความเข้มข้นของฝุ่น PM2.5 (ตัวแปรเป้าหมาย) | μg/m³ |
| PM10 | ค่าความเข้มข้นของฝุ่น PM10 | μg/m³ |
| O3 | ค่าความเข้มข้นของก๊าซโอโซน | ppb |
| CO | ค่าความเข้มข้นของก๊าซคาร์บอนมอนอกไซด์ | ppm |
| NO2 | ค่าความเข้มข้นของก๊าซไนโตรเจนไดออกไซด์ | ppb |
| SO2 | ค่าความเข้มข้นของก๊าซซัลเฟอร์ไดออกไซด์ | ppb |
| Temperature | อุณหภูมิอากาศ | °C |
| Relative Humidity | ความชื้นสัมพัทธ์ | % |
| Wind Speed | ความเร็วลม | m/s |
| Wind Direction | ทิศทางลม | องศา |
| Timestamp | วันและเวลาที่บันทึกข้อมูล | YYYY-MM-DD HH:mm |
| Station ID | รหัสสถานีตรวจวัด | - |

ขนาดข้อมูลโดยประมาณ: สถานีตรวจวัดจำนวนมากกว่า 60 สถานีทั่วประเทศ หากรวบรวมข้อมูลย้อนหลัง 3–5 ปี คาดว่าจะมีจำนวนแถวข้อมูลรวมมากกว่า 1,500,000 แถว

### 2.4 กลยุทธ์การแบ่งข้อมูล (Data Splitting Strategy)

เนื่องจากข้อมูลมีลักษณะเป็นอนุกรมเวลา การแบ่งข้อมูลจะใช้หลักการ **temporal split** เพื่อป้องกัน data leakage กล่าวคือ ข้อมูลในอดีตจะถูกใช้ฝึกสอนโมเดล และข้อมูลในอนาคตจะถูกใช้ทดสอบ ดังนี้:

- **Training Set (~70%):** ข้อมูลในช่วงปีแรก ๆ สำหรับการฝึกสอนโมเดล
- **Validation Set (~15%):** ข้อมูลในช่วงถัดมา สำหรับการปรับ Hyperparameter และเลือกโมเดล
- **Test Set (~15%):** ข้อมูลในช่วงล่าสุด สำหรับการประเมินผลครั้งสุดท้าย (ห้ามใช้ระหว่างการพัฒนาโมเดล)

ตัวอย่างเช่น หากใช้ข้อมูล 4 ปี:
- Training: ปีที่ 1–3 (ประมาณ 3 ปีแรก)
- Validation: ช่วง 6 เดือนถัดมา
- Test: 6 เดือนสุดท้าย

### 2.5 ข้อพิจารณาด้านความเป็นส่วนตัว, PDPA และจริยธรรม

**การประเมินข้อมูลส่วนบุคคล:**

ชุดข้อมูลจาก Air4Thai เป็นข้อมูลคุณภาพอากาศสิ่งแวดล้อม **ไม่มีข้อมูลส่วนบุคคล (personal data)** ของบุคคลใดบุคคลหนึ่งโดยตรง เป็นข้อมูลเชิงสิ่งแวดล้อมที่เปิดเผยต่อสาธารณะ ดังนั้นจึงไม่อยู่ภายใต้ข้อกังวลหลักของ พ.ร.บ. คุ้มครองข้อมูลส่วนบุคคล พ.ศ. 2562 (PDPA)

**ข้อมูลที่อาจมีความอ่อนไหว:**

แม้ข้อมูลจะไม่ใช่ข้อมูลส่วนบุคคล แต่ตำแหน่งของสถานีตรวจวัดและค่าที่วัดได้อาจมีนัยยะต่อคุณค่าของที่ดินหรือชุมชน ซึ่งควรระมัดระวังในการนำเสนอผลลัพธ์

**กลยุทธ์ลดความเสี่ยงด้านความเป็นส่วนตัว:**

- ใช้เฉพาะข้อมูลที่เปิดเผยต่อสาธารณะจากแพลตฟอร์ม Air4Thai อย่างเป็นทางการ
- ไม่มีการเชื่อมโยงข้อมูลกับตัวตนของบุคคล
- จัดเก็บข้อมูลไว้ในสภาพแวดล้อมที่ปลอดภัย

**ความเสี่ยงจากการพยากรณ์ผิดพลาด:**

| ประเภทความผิดพลาด | ผลกระทบ |
|---|---|
| False Negative (พยากรณ์ต่ำกว่าความเป็นจริง) | ประชาชนไม่ระวังตัวทั้งที่อากาศเป็นอันตราย อาจเป็นอันตรายต่อสุขภาพ โดยเฉพาะกลุ่มเสี่ยง |
| False Positive (พยากรณ์สูงกว่าความเป็นจริง) | เกิดความตื่นตระหนกโดยไม่จำเป็น อาจส่งผลเสียต่อกิจกรรมทางเศรษฐกิจ |

ในด้านจริยธรรม ระบบควรออกแบบให้ **conservative** กล่าวคือ หากไม่มั่นใจ ควรพยากรณ์ในด้านที่ระมัดระวังกว่า (เตือนมากกว่า) เพื่อลดความเสี่ยงด้านสุขภาพ

---

## 3. Data Engineering และการเตรียมข้อมูลสำหรับการฝึกสอน (Data Engineering & Training Data Considerations)

### 3.1 แนวทางการทำความสะอาดข้อมูล (Data Cleaning)

ข้อมูลจากเซ็นเซอร์ตรวจวัดคุณภาพอากาศมักมีปัญหาคุณภาพข้อมูลหลายประเภท จึงต้องดำเนินการขั้นตอนการทำความสะอาดข้อมูลอย่างเป็นระบบ ได้แก่:

1. **การตรวจสอบค่าผิดปกติ (Outlier Detection):** ค่าที่เกินขีดจำกัดทางกายภาพ เช่น PM2.5 < 0 หรือ > 1,000 μg/m³ จะถูกทำเครื่องหมายว่าเป็นข้อมูลที่น่าสงสัยและพิจารณาเอาออกหรือทดแทน
2. **การตรวจสอบความสม่ำเสมอของข้อมูล (Consistency Check):** ตรวจสอบว่าข้อมูลในแต่ละช่วงเวลาครบถ้วนและไม่มีช่องว่างเวลา (time gap) ที่ผิดปกติ
3. **การแปลงประเภทข้อมูล:** แปลงคอลัมน์ timestamp ให้อยู่ในรูปแบบ datetime ที่ถูกต้อง และจัดเรียงข้อมูลตามลำดับเวลา

### 3.2 การจัดการข้อมูลสูญหาย (Handling Missing Values)

ข้อมูลสูญหายในอนุกรมเวลาสิ่งแวดล้อมเป็นเรื่องปกติ เกิดจากการบำรุงรักษาอุปกรณ์ ไฟฟ้าขัดข้อง หรือความผิดพลาดของระบบส่งข้อมูล แนวทางการจัดการมีดังนี้:

- **ช่องว่างสั้น (≤ 3 ชั่วโมง):** ใช้การ interpolation แบบ linear หรือ forward fill
- **ช่องว่างปานกลาง (4–24 ชั่วโมง):** พิจารณาใช้ค่าเฉลี่ยจากวันเดียวกันในสัปดาห์ก่อนหน้า (seasonal naive)
- **ช่องว่างยาว (> 24 ชั่วโมง):** ทำเครื่องหมายหรือตัดออกจากการฝึกสอน เนื่องจากการ impute ข้อมูลจำนวนมากอาจทำให้โมเดลเรียนรู้รูปแบบที่ผิดพลาด
- **บันทึกสัดส่วนข้อมูลสูญหาย** ต่อสถานีและต่อช่วงเวลา เพื่อใช้ประกอบการตัดสินใจในขั้นตอน feature engineering

### 3.3 การจัดการข้อมูลจากเซ็นเซอร์ที่มีสัญญาณรบกวน (Handling Noisy Sensor Data)

สัญญาณรบกวนในข้อมูลเซ็นเซอร์สามารถเกิดจากหลายสาเหตุ เช่น การสอบเทียบอุปกรณ์ไม่ถูกต้อง หรือสภาพแวดล้อมที่ผิดปกติชั่วคราว วิธีการที่จะนำมาใช้ประกอบด้วย:

- **Rolling Median Filter:** ใช้ค่ามัธยฐานในหน้าต่างเวลาขนาดเล็ก (เช่น 3 ชั่วโมง) เพื่อลดผลกระทบจาก spike ที่เกิดขึ้นชั่วคราว
- **Z-score Thresholding:** ค่าที่มี z-score เกิน 3 จะถูกพิจารณาเป็น noise และถูกทดแทน
- **Smoothed Features:** สร้าง feature ที่ผ่านการ smooth เพื่อให้โมเดลเรียนรู้รูปแบบที่แท้จริงมากกว่าการตอบสนองต่อ noise

### 3.4 สมมติฐานเกี่ยวกับความสม่ำเสมอของสถานีตรวจวัด

โครงการนี้ตั้งสมมติฐานไว้ว่า:
- แต่ละสถานีตรวจวัดมีคุณสมบัติเฉพาะ (micro-climate) ที่แตกต่างกัน จึงควรพิจารณาการสร้างโมเดลแยกรายสถานี หรือใช้ station ID เป็น feature เพิ่มเติม
- สถานีที่มีข้อมูลสูญหายสูงกว่า 30% จะถูกพิจารณาตัดออกจากการวิเคราะห์หลัก

### 3.5 ความน่าเชื่อถือของ Label (Label Reliability)

ค่า PM2.5 ที่วัดได้จากเซ็นเซอร์มีความคลาดเคลื่อนตามคุณสมบัติของอุปกรณ์ โดยทั่วไป เซ็นเซอร์เกรดอ้างอิง (reference-grade) มีความแม่นยำสูงกว่าเซ็นเซอร์ราคาถูก ในโครงการนี้จะสมมติว่าข้อมูลจาก Air4Thai มาจากเซ็นเซอร์มาตรฐาน จึงมีความน่าเชื่อถือในระดับที่ยอมรับได้ โดยมีความคลาดเคลื่อนในการวัดประมาณ ±5–10%

### 3.6 ความไม่สมดุลของคลาส (Class Imbalance)

แม้ว่าโครงการนี้จะมุ่งเน้นการพยากรณ์ในรูปแบบ **regression** (ทำนายค่าตัวเลขของ PM2.5) แต่หากมีการแปลงเป็น classification (เช่น ระดับ AQI: ดี, ปานกลาง, อันตราย) จะพบว่าข้อมูลมีความไม่สมดุล เนื่องจากค่า PM2.5 ที่อยู่ในระดับ "อันตราย" มักพบน้อยกว่าระดับปกติ ซึ่งต้องใช้เทคนิค เช่น SMOTE หรือการปรับน้ำหนักคลาส (class weighting) เพื่อจัดการกับปัญหานี้

### 3.7 การป้องกัน Time-Series Leakage

การรั่วไหลของข้อมูลในอนุกรมเวลา (temporal data leakage) เป็นปัญหาสำคัญที่ต้องหลีกเลี่ยงอย่างเคร่งครัด แนวทางที่จะนำมาใช้ประกอบด้วย:

- **Strict Temporal Split:** ข้อมูล validation และ test จะต้องเกิดขึ้นหลังจากข้อมูล training ทั้งหมดตามลำดับเวลา
- **Lag Feature Validation:** lag feature ทั้งหมดจะถูกสร้างจากข้อมูลในอดีตเท่านั้น ไม่มีการใช้ข้อมูล "อนาคต" ในการสร้าง feature
- **Rolling Statistics:** การคำนวณค่าเฉลี่ยหรือสถิติแบบ rolling window จะใช้เฉพาะข้อมูลก่อนหน้า ณ เวลาที่ทำนาย
- **Walk-Forward Validation:** ใช้เทคนิค time series cross-validation แบบ walk-forward เพื่อประเมินประสิทธิภาพโมเดลอย่างถูกต้อง

---

## 4. แผนการสร้าง Feature (Feature Engineering Plan)

### 4.1 Feature ที่เกี่ยวข้องกับเวลา (Time-based Features)

ข้อมูลอนุกรมเวลาของ PM2.5 มีรูปแบบตามช่วงเวลาที่ชัดเจน feature ที่จะสร้างได้แก่:

| Feature | คำอธิบาย | หมายเหตุ |
|---|---|---|
| Hour of Day | ชั่วโมงในวัน (0–23) | encode แบบ cyclical (sin/cos) |
| Day of Week | วันในสัปดาห์ (0–6) | encode แบบ cyclical |
| Month | เดือนในปี (1–12) | encode แบบ cyclical |
| Season | ฤดูกาล (ร้อน/ฝน/หนาว) | categorical encoding |
| Is Weekend | วันหยุดสุดสัปดาห์ | binary flag |
| Is Holiday | วันหยุดนักขัตฤกษ์ไทย | binary flag |
| Year | ปีของข้อมูล | สำหรับการจับแนวโน้มระยะยาว |

### 4.2 Feature ที่เกี่ยวข้องกับสภาพอากาศ (Weather-related Features)

- อุณหภูมิ (Temperature) และการแปลงรูป เช่น temperature squared เพื่อจับความสัมพันธ์แบบไม่เชิงเส้น
- ความชื้นสัมพัทธ์ (Relative Humidity) และปฏิสัมพันธ์กับอุณหภูมิ
- ความเร็วลม (Wind Speed) — ลมแรงมักช่วยลด PM2.5
- ทิศทางลม (Wind Direction) encode แบบ sin/cos เพื่อรักษาความสัมพันธ์แบบวงกลม
- ค่ามลพิษอื่น ๆ (PM10, NO2, CO, SO2, O3) ที่มีความสัมพันธ์กับ PM2.5

### 4.3 Lag Features (ค่า PM2.5 ในอดีต)

Lag features เป็นตัวแปรที่สำคัญที่สุดสำหรับการพยากรณ์อนุกรมเวลา:

| Feature | คำอธิบาย |
|---|---|
| PM2.5\_lag\_1h | ค่า PM2.5 ก่อนหน้า 1 ชั่วโมง |
| PM2.5\_lag\_2h | ค่า PM2.5 ก่อนหน้า 2 ชั่วโมง |
| PM2.5\_lag\_3h | ค่า PM2.5 ก่อนหน้า 3 ชั่วโมง |
| PM2.5\_lag\_6h | ค่า PM2.5 ก่อนหน้า 6 ชั่วโมง |
| PM2.5\_lag\_12h | ค่า PM2.5 ก่อนหน้า 12 ชั่วโมง |
| PM2.5\_lag\_24h | ค่า PM2.5 ก่อนหน้า 24 ชั่วโมง (รูปแบบรายวัน) |
| PM2.5\_lag\_168h | ค่า PM2.5 ก่อนหน้า 168 ชั่วโมง (รูปแบบรายสัปดาห์) |

### 4.4 Rolling Average Features

| Feature | คำอธิบาย |
|---|---|
| PM2.5\_rolling\_mean\_3h | ค่าเฉลี่ยเคลื่อนที่ 3 ชั่วโมงที่ผ่านมา |
| PM2.5\_rolling\_mean\_6h | ค่าเฉลี่ยเคลื่อนที่ 6 ชั่วโมงที่ผ่านมา |
| PM2.5\_rolling\_mean\_24h | ค่าเฉลี่ยเคลื่อนที่ 24 ชั่วโมงที่ผ่านมา |
| PM2.5\_rolling\_std\_6h | ส่วนเบี่ยงเบนมาตรฐานเคลื่อนที่ 6 ชั่วโมง (ความผันผวน) |
| PM2.5\_rolling\_max\_24h | ค่าสูงสุดในช่วง 24 ชั่วโมงที่ผ่านมา |
| Temp\_rolling\_mean\_3h | ค่าเฉลี่ยอุณหภูมิเคลื่อนที่ 3 ชั่วโมง |

### 4.5 Feature ที่ตัดออกและเหตุผล

| Feature ที่ตัดออก | เหตุผล |
|---|---|
| ข้อมูลสภาพอากาศในอนาคต (forecast weather) | ในสภาพจริง อาจไม่มีข้อมูลนี้ขณะทำนาย และทำให้เกิด data leakage |
| ข้อมูล GPS พิกัดของสถานี | ซ้ำกับข้อมูลที่ถูกจับโดย Station ID แล้ว |
| ค่า AQI Index (ที่คำนวณจาก PM2.5) | เป็น derived feature จากตัวแปรเป้าหมายโดยตรง ทำให้เกิด leakage |
| ชื่อสถานีแบบ text (raw string) | ใช้ Station ID แบบ encoded แทนเพื่อความสม่ำเสมอ |

---

## 5. โมเดล Baseline (Baseline Model)

### 5.1 โมเดล Baseline ที่เลือก

โครงการนี้เลือกใช้ **Persistence Model** (หรือที่เรียกว่า "Naive Model") เป็นโมเดล Baseline หลัก โดยมีหลักการว่า: **ค่า PM2.5 ณ เวลา t+1 เท่ากับค่า PM2.5 ณ เวลา t**

นอกจากนี้ ยังใช้ **Linear Regression** ที่ใช้เฉพาะ lag feature (PM2.5\_lag\_1h) เป็น baseline รอง เพื่อวัดว่า ML model ที่ซับซ้อนขึ้นให้ผลดีกว่า linear model อย่างมีนัยสำคัญหรือไม่

### 5.2 เหตุผลในการเลือก Baseline

- **Persistence Model** เหมาะสำหรับข้อมูลอนุกรมเวลาที่มีความต่อเนื่อง เนื่องจากค่า PM2.5 มักมีการเปลี่ยนแปลงค่อนข้างช้าในระยะสั้น โมเดลนี้จึงเป็น "lower bound" ที่สมเหตุสมผลสำหรับการเปรียบเทียบ
- **Linear Regression** ช่วยให้เห็นว่าความสัมพันธ์เชิงเส้นแบบง่ายสามารถอธิบายรูปแบบของข้อมูลได้มากน้อยเพียงใด

### 5.3 ค่าตัวชี้วัดที่คาดหวัง

| ตัวชี้วัด | คำอธิบาย |
|---|---|
| MAE (Mean Absolute Error) | วัดความคลาดเคลื่อนเฉลี่ยในหน่วยเดียวกับ PM2.5 (μg/m³) |
| RMSE (Root Mean Squared Error) | ให้น้ำหนักกับความคลาดเคลื่อนขนาดใหญ่มากกว่า |

ค่า Baseline ที่ควรทำได้ดีกว่าจึงจะพิจารณาว่าโมเดลมีประโยชน์ จะกำหนดหลังจากวิเคราะห์ข้อมูลเบื้องต้น (exploratory data analysis) แล้ว

---

## 6. โมเดลที่เป็น Candidate (Candidate Models)

### 6.1 โมเดล A: Random Forest Regressor

**เหตุผลในการเลือก:**  
Random Forest เป็นโมเดล ensemble ที่ทนทานต่อข้อมูล noisy และ missing values ได้ดี มีความสามารถในการจับความสัมพันธ์แบบไม่เชิงเส้น (nonlinear relationships) ระหว่าง feature ต่าง ๆ และสามารถประเมินความสำคัญของ feature (feature importance) ได้ ซึ่งเป็นประโยชน์ต่อการตีความโมเดล (interpretability) นอกจากนี้ยังทำงานได้ดีโดยไม่ต้องปรับ hyperparameter มาก

**ความแตกต่างจาก Baseline:**  
Random Forest สามารถจับความสัมพันธ์ระหว่าง feature หลายตัวพร้อมกันได้ ซึ่งต่างจาก Persistence Model ที่ใช้เพียงค่าล่าสุด และต่างจาก Linear Regression ที่จับได้เฉพาะความสัมพันธ์เชิงเส้น

### 6.2 โมเดล B: XGBoost (Extreme Gradient Boosting) Regressor

**เหตุผลในการเลือก:**  
XGBoost เป็นโมเดล gradient boosting ที่มีประสิทธิภาพสูงและเป็นที่นิยมในงาน tabular data competition ต่าง ๆ มีกลไก regularization ที่ช่วยลดปัญหา overfitting มีความเร็วในการฝึกสอนสูง และรองรับการประมวลผลแบบขนาน นอกจากนี้ยังมี built-in feature importance ที่มีประโยชน์ต่อการวิเคราะห์

**ความแตกต่างจาก Baseline:**  
XGBoost สร้าง ensemble ของ weak learners แบบ sequential ทำให้สามารถจับรูปแบบที่ซับซ้อนได้ดีกว่า Linear Regression และมีประสิทธิภาพดีกว่า Random Forest ในกรณีที่ข้อมูลมีโครงสร้างที่ซับซ้อน เนื่องจากการสร้างโมเดลแบบ boosting ที่เรียนรู้จากความผิดพลาดของโมเดลก่อนหน้า

### 6.3 โมเดล C: LSTM (Long Short-Term Memory) Neural Network

**เหตุผลในการเลือก:**  
LSTM เป็น Recurrent Neural Network (RNN) ที่ออกแบบมาเป็นพิเศษสำหรับข้อมูลอนุกรมเวลา มีความสามารถในการจดจำรูปแบบระยะยาว (long-term dependencies) ซึ่งเหมาะกับปัญหา PM2.5 ที่มีรูปแบบตามฤดูกาลและแนวโน้มระยะยาว โดยไม่จำเป็นต้องสร้าง lag feature ด้วยตนเอง เนื่องจากโครงสร้างของ LSTM จดจำลำดับข้อมูลได้โดยธรรมชาติ

**ความแตกต่างจาก Baseline:**  
LSTM เป็นโมเดล deep learning ที่มีความสามารถในการเรียนรู้รูปแบบที่ซับซ้อนมากจากลำดับข้อมูล ต่างจาก tree-based models ที่ใช้ข้อมูลแบบตารางในขณะที่ LSTM รับข้อมูลเป็น sequence โดยตรง อย่างไรก็ตาม โมเดลนี้ต้องการข้อมูลจำนวนมากและเวลาในการฝึกสอนมากกว่า

---

## 7. การตั้งค่าการทดลอง (Experiment Setup)

### 7.1 กลยุทธ์การเปรียบเทียบโมเดลอย่างเป็นธรรม (Fair Comparison Strategy)

เพื่อให้การเปรียบเทียบโมเดลมีความน่าเชื่อถือและเป็นธรรม จะยึดหลักการดังนี้:

- โมเดลทุกตัวจะถูกประเมินบน **ชุดข้อมูล test set เดียวกัน** ที่ไม่ถูกใช้ระหว่างการพัฒนา
- ใช้ **pipeline การ preprocessing เดียวกัน** สำหรับโมเดลทุกตัว โดยใช้ sklearn Pipeline เพื่อป้องกัน data leakage จาก preprocessing
- บันทึก **hyperparameter ทุกตัว** และ configuration ของโมเดลทั้งหมดไว้ในไฟล์ config

### 7.2 Pipeline การ Preprocessing ที่ใช้ร่วมกัน

```
Raw Data → Data Cleaning → Feature Engineering → Feature Scaling → Model
```

สำหรับ tree-based models (Random Forest, XGBoost): ไม่จำเป็นต้อง feature scaling  
สำหรับ LSTM: ใช้ MinMaxScaler หรือ StandardScaler โดย fit บน training set เท่านั้น

### 7.3 การแบ่งข้อมูลที่ใช้ร่วมกัน

โมเดลทุกตัวใช้การแบ่งข้อมูลแบบ temporal split เดียวกัน ดังนี้:
- Training Set: ข้อมูล 70% แรก (ตามลำดับเวลา)
- Validation Set: ข้อมูล 15% ถัดมา
- Test Set: ข้อมูล 15% สุดท้าย

### 7.4 กลยุทธ์การปรับ Hyperparameter

| โมเดล | วิธีการ | Hyperparameter หลัก |
|---|---|---|
| Random Forest | RandomizedSearchCV | n\_estimators, max\_depth, min\_samples\_split, max\_features |
| XGBoost | RandomizedSearchCV | n\_estimators, learning\_rate, max\_depth, subsample, colsample\_bytree |
| LSTM | Manual Grid Search + Early Stopping | units, layers, dropout\_rate, learning\_rate, batch\_size |

ใช้ **time series cross-validation** (walk-forward) แทน k-fold cross-validation ทั่วไป เพื่อป้องกัน data leakage และให้การประเมิน validation score ที่สมจริงมากขึ้น

### 7.5 การสร้างความสามารถทำซ้ำได้ (Reproducibility)

- กำหนด **random seed คงที่** (เช่น seed=42) สำหรับทุกกระบวนการที่มีความสุ่ม
- บันทึก **เวอร์ชันของ library** ทั้งหมดใน requirements.txt หรือ environment.yml
- ใช้ **version control (Git)** เพื่อจัดการโค้ดและการเปลี่ยนแปลง
- จัดเก็บ **pipeline configuration** ในไฟล์ YAML เพื่อให้สามารถ reproduce การทดลองได้
- บันทึก **experiment logs** รวมถึง metric, hyperparameter, และ timestamp ของทุกการทดลอง

---

## 8. การประเมินผลแบบออฟไลน์และผลลัพธ์ (Offline Evaluation & Results)

### 8.1 ตัวชี้วัดหลัก (Primary Metric)

**RMSE (Root Mean Squared Error)** ถูกเลือกเป็นตัวชี้วัดหลัก เนื่องจาก:
- อยู่ในหน่วยเดียวกับ PM2.5 (μg/m³) ทำให้ตีความได้ง่าย
- ให้น้ำหนักกับความคลาดเคลื่อนขนาดใหญ่มากกว่า MAE ซึ่งสำคัญในบริบทด้านสาธารณสุข เนื่องจากการพยากรณ์ผิดพลาดมากในช่วงที่ค่าสูงจะมีผลกระทบรุนแรงกว่า

### 8.2 ตัวชี้วัดรอง (Secondary Metrics)

| ตัวชี้วัด | เหตุผล |
|---|---|
| MAE (Mean Absolute Error) | เข้าใจง่าย ทนทานต่อ outlier มากกว่า RMSE |
| R² (Coefficient of Determination) | วัดสัดส่วนความแปรปรวนที่โมเดลอธิบายได้ |
| MAPE (Mean Absolute Percentage Error) | ช่วยตีความในแง่ร้อยละ โดยเฉพาะเมื่อค่า PM2.5 มีขนาดต่างกันมาก |

### 8.3 ตารางเปรียบเทียบผลลัพธ์ (Comparison Table)

ตารางต่อไปนี้แสดงโครงสร้างที่จะใช้บันทึกผลการทดลอง ค่าตัวเลขจริงจะถูกกรอกหลังจากดำเนินการทดลองเสร็จสิ้น

| โมเดล | RMSE (μg/m³) | MAE (μg/m³) | R² | เวลาฝึกสอน (วินาที) | หมายเหตุ |
|---|---|---|---|---|---|
| Persistence Model (Baseline) | TBD | TBD | TBD | N/A | Naive baseline |
| Linear Regression (Baseline 2) | TBD | TBD | TBD | TBD | Simple ML baseline |
| Random Forest (Model A) | TBD | TBD | TBD | TBD | Tree-based ensemble |
| XGBoost (Model B) | TBD | TBD | TBD | TBD | Gradient boosting |
| LSTM (Model C) | TBD | TBD | TBD | TBD | Deep learning |

*หมายเหตุ: ค่า TBD (To Be Determined) จะถูกกำหนดหลังจากการทดลองจริง*

---

## 9. การวิเคราะห์และการคัดเลือกโมเดล (Analysis & Model Selection)

### 9.1 กรอบการวิเคราะห์โมเดล

การคัดเลือกโมเดลในโครงการนี้จะพิจารณาจากมิติหลายด้านนอกเหนือจากค่า RMSE เพียงอย่างเดียว โดยใช้กรอบการพิจารณาเชิงระบบ (system-level reasoning) ดังนี้:

**ด้านประสิทธิภาพการพยากรณ์:**
- โมเดลใดให้ค่า RMSE และ MAE ต่ำที่สุดบน test set?
- ประสิทธิภาพสม่ำเสมอในช่วงเวลาต่าง ๆ หรือไม่ (เช่น ฤดูหมอกควัน vs ฤดูฝน)?
- โมเดลสามารถตรวจจับเหตุการณ์ค่า PM2.5 สูงผิดปกติ (extreme events) ได้ดีแค่ไหน?

**ด้านความสามารถตีความ (Interpretability):**
- Random Forest และ XGBoost มี feature importance ที่ช่วยอธิบายการตัดสินใจได้
- LSTM มีความสามารถตีความน้อยกว่า (black box)

**ด้านความซับซ้อนและต้นทุนการดำเนินงาน (Operational Complexity):**
- เวลาและทรัพยากรที่ต้องการในการฝึกสอน
- เวลาที่ใช้ในการ inference (สำคัญสำหรับการใช้งานแบบ real-time)
- ความซับซ้อนในการ deploy และ maintain

### 9.2 การแลกเปลี่ยน (Trade-offs) ที่คาดว่าจะพบ

| การแลกเปลี่ยน | รายละเอียด |
|---|---|
| ประสิทธิภาพ vs ความสามารถตีความ | LSTM อาจให้ RMSE ต่ำกว่า แต่ตีความได้ยากกว่า |
| ประสิทธิภาพ vs ความเร็ว inference | Random Forest อาจช้ากว่า XGBoost เมื่อ deploy จริง |
| ความซับซ้อนของโมเดล vs ความต้องการข้อมูล | LSTM ต้องการข้อมูลมากกว่า tree-based models |
| Generalization vs Overfitting | โมเดลที่ซับซ้อนมักเสี่ยง overfit มากกว่า |

### 9.3 กระบวนการตัดสินใจคัดเลือกโมเดลสุดท้าย

การคัดเลือกโมเดลจะใช้กระบวนการดังนี้:

1. **คัดกรองเบื้องต้น:** โมเดลที่ดีกว่า Persistence Model baseline อย่างมีนัยสำคัญทางสถิติเท่านั้น จึงจะผ่านการพิจารณา
2. **เปรียบเทียบบน test set:** ประเมิน RMSE และ MAE บน test set ที่ไม่เคยถูกใช้ระหว่างการพัฒนา
3. **วิเคราะห์ error pattern:** ตรวจสอบว่าโมเดลทำได้ดีในสถานการณ์ที่สำคัญ (ค่า PM2.5 สูง) หรือไม่
4. **ประเมินความพร้อมในการนำไปใช้งานจริง:** พิจารณา latency, memory footprint, และความง่ายในการ maintain

### 9.4 โมเดลที่คาดว่าจะถูกเลือก (เหตุผลเชิงระบบ)

จากการวิเคราะห์เชิงทฤษฎี คาดว่า **XGBoost** จะเป็นตัวเลือกที่สมดุลที่สุดสำหรับโครงการนี้ เนื่องจาก:

- มีประสิทธิภาพสูงบนข้อมูลแบบตาราง (tabular data) ที่มีการสร้าง lag features แล้ว
- มีความเร็วในการฝึกสอนและ inference ที่ดี เหมาะกับการนำไปใช้งานจริง
- มี built-in regularization ที่ช่วยลด overfitting
- ให้ feature importance ที่สามารถอธิบายให้กับผู้มีส่วนได้ส่วนเสียที่ไม่ใช่นักเทคนิคได้

อย่างไรก็ตาม หาก LSTM แสดงให้เห็นประสิทธิภาพที่เหนือกว่าอย่างมีนัยสำคัญ (เช่น RMSE ต่ำกว่ามากกว่า 10%) และข้อจำกัดด้าน latency ไม่ใช่ปัญหา การเลือก LSTM ก็มีความสมเหตุสมผล

การตัดสินใจขั้นสุดท้ายจะอ้างอิงจากผลการทดลองจริง และจะรายงานในรายงานความก้าวหน้าครั้งถัดไป

---

## บทสรุป (Conclusion)

รายงานความก้าวหน้าครั้งที่ 1 นี้ได้นำเสนอภาพรวมของ **ระบบพยากรณ์ค่าฝุ่น PM2.5 ด้วยเทคนิค Machine Learning** อย่างครบถ้วนในระดับการออกแบบระบบ โดยครอบคลุมตั้งแต่การกำหนดปัญหา การอธิบายชุดข้อมูล กระบวนการ Data Engineering แผนการสร้าง Feature การออกแบบโมเดลและการทดลอง ตลอดจนกรอบการประเมินและคัดเลือกโมเดล

ขั้นตอนต่อไปของโครงการประกอบด้วย:
1. การดาวน์โหลดและสำรวจข้อมูลจริงจาก Air4Thai (Exploratory Data Analysis)
2. การ implement Data Engineering Pipeline
3. การฝึกสอนและประเมินโมเดล Baseline
4. การฝึกสอนและประเมินโมเดล Candidate ทั้งสาม
5. การวิเคราะห์และคัดเลือกโมเดลสุดท้าย

การออกแบบระบบในรายงานนี้มุ่งเน้นหลักการสำคัญของ ML Systems ได้แก่ **Reproducibility**, **Fair Evaluation**, **Temporal Data Integrity**, และ **System-Level Reasoning** เพื่อให้ได้ระบบพยากรณ์ที่มีคุณภาพสูง สามารถนำไปใช้งานจริงได้ และเกิดประโยชน์สูงสุดต่อสังคม

---

*จัดทำโดย: นักศึกษาวิชา Machine Learning Systems*  
*วันที่จัดทำ: กุมภาพันธ์ 2569*  
*แหล่งอ้างอิงข้อมูล: กรมควบคุมมลพิษ — Air4Thai (http://air4thai.pcd.go.th/webV3/#/History)*
